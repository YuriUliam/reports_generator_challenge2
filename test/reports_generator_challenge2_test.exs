defmodule ReportsGeneratorChallenge2Test do
  use ExUnit.Case

  describe "build/1" do
    test "builds the report" do
      filename = "part_min.csv"

      response = ReportsGeneratorChallenge2.build(filename)

      expected_response = %{
        "all_hours" => %{
          "Cleiton" => 58,
          "Daniele" => 35,
          "Danilo" => 30,
          "Diego" => 51,
          "Giuliano" => 38,
          "Jakeliny" => 57,
          "Joseph" => 48,
          "Mayk" => 50,
          "Rafael" => 35,
          "Vinicius" => 30
        },
        "hours_per_month" => %{
          "Cleiton" => %{
            1 => 0,
            2 => 1,
            3 => 8,
            4 => 5,
            5 => 4,
            6 => 13,
            7 => 7,
            8 => 0,
            9 => 0,
            10 => 14,
            11 => 0,
            12 => 6
          },
          "Daniele" => %{
            1 => 5,
            2 => 1,
            3 => 0,
            4 => 7,
            5 => 8,
            6 => 5,
            7 => 0,
            8 => 0,
            9 => 0,
            10 => 4,
            11 => 0,
            12 => 5
          },
          "Danilo" => %{
            1 => 0,
            2 => 7,
            3 => 4,
            4 => 1,
            5 => 0,
            6 => 3,
            7 => 0,
            8 => 0,
            9 => 0,
            10 => 8,
            11 => 7,
            12 => 0
          },
          "Diego" => %{
            1 => 0,
            2 => 2,
            3 => 14,
            4 => 8,
            5 => 1,
            6 => 6,
            7 => 11,
            8 => 5,
            9 => 3,
            10 => 0,
            11 => 0,
            12 => 1
          },
          "Giuliano" => %{
            1 => 0,
            2 => 9,
            3 => 0,
            4 => 7,
            5 => 4,
            6 => 0,
            7 => 0,
            8 => 3,
            9 => 5,
            10 => 0,
            11 => 8,
            12 => 2
          },
          "Jakeliny" => %{
            1 => 0,
            2 => 0,
            3 => 14,
            4 => 0,
            5 => 1,
            6 => 4,
            7 => 14,
            8 => 7,
            9 => 0,
            10 => 8,
            11 => 0,
            12 => 9
          },
          "Joseph" => %{
            1 => 0,
            2 => 0,
            3 => 3,
            4 => 4,
            5 => 3,
            6 => 0,
            7 => 4,
            8 => 5,
            9 => 4,
            10 => 0,
            11 => 5,
            12 => 20
          },
          "Mayk" => %{
            1 => 0,
            2 => 0,
            3 => 15,
            4 => 4,
            5 => 0,
            6 => 3,
            7 => 7,
            8 => 0,
            9 => 8,
            10 => 0,
            11 => 4,
            12 => 9
          },
          "Rafael" => %{
            1 => 9,
            2 => 0,
            3 => 0,
            4 => 2,
            5 => 0,
            6 => 0,
            7 => 13,
            8 => 11,
            9 => 0,
            10 => 0,
            11 => 0,
            12 => 0
          },
          "Vinicius" => %{
            1 => 0,
            2 => 0,
            3 => 3,
            4 => 0,
            5 => 0,
            6 => 6,
            7 => 8,
            8 => 8,
            9 => 0,
            10 => 5,
            11 => 0,
            12 => 0
          }
        },
        "hours_per_year" => %{
          "Cleiton" => %{2016 => 4, 2017 => 7, 2018 => 13, 2019 => 6, 2020 => 28},
          "Daniele" => %{2016 => 15, 2017 => 3, 2018 => 12, 2019 => 0, 2020 => 5},
          "Danilo" => %{2016 => 7, 2017 => 7, 2018 => 1, 2019 => 14, 2020 => 1},
          "Diego" => %{2016 => 4, 2017 => 24, 2018 => 7, 2019 => 1, 2020 => 15},
          "Giuliano" => %{2016 => 7, 2017 => 8, 2018 => 9, 2019 => 6, 2020 => 8},
          "Jakeliny" => %{2016 => 16, 2017 => 9, 2018 => 6, 2019 => 13, 2020 => 13},
          "Joseph" => %{2016 => 0, 2017 => 4, 2018 => 3, 2019 => 7, 2020 => 34},
          "Mayk" => %{2016 => 11, 2017 => 8, 2018 => 0, 2019 => 13, 2020 => 18},
          "Rafael" => %{2016 => 11, 2017 => 18, 2018 => 0, 2019 => 2, 2020 => 4},
          "Vinicius" => %{2016 => 8, 2017 => 6, 2018 => 0, 2019 => 0, 2020 => 16}
        }
      }

      assert response == expected_response
    end
  end

  describe "build_from_many/1" do
    test "when a file list is provided, builds the report" do
      filenames = ["part_1.csv", "part_2.csv", "part_3.csv"]

      response = ReportsGeneratorChallenge2.build_from_many(filenames)

      expected_response =
        {:ok,
         %{
           "all_hours" => %{
             "Cleiton" => 13797,
             "Daniele" => 13264,
             "Danilo" => 13583,
             "Diego" => 13015,
             "Giuliano" => 13671,
             "Jakeliny" => 13909,
             "Joseph" => 13174,
             "Mayk" => 13526,
             "Rafael" => 13597,
             "Vinicius" => 13412
           },
           "hours_per_month" => %{
             "Cleiton" => %{
               1 => 1271,
               2 => 1168,
               3 => 1091,
               4 => 1161,
               5 => 998,
               6 => 1123,
               7 => 1236,
               8 => 1149,
               9 => 1161,
               10 => 1073,
               11 => 1266,
               12 => 1100
             },
             "Daniele" => %{
               1 => 1130,
               2 => 1003,
               3 => 1177,
               4 => 1138,
               5 => 1170,
               6 => 1092,
               7 => 1135,
               8 => 1018,
               9 => 1205,
               10 => 1046,
               11 => 1131,
               12 => 1019
             },
             "Danilo" => %{
               1 => 1121,
               2 => 1156,
               3 => 1096,
               4 => 1232,
               5 => 1075,
               6 => 966,
               7 => 1114,
               8 => 1200,
               9 => 1115,
               10 => 1237,
               11 => 1122,
               12 => 1149
             },
             "Diego" => %{
               1 => 1118,
               2 => 1144,
               3 => 1029,
               4 => 1112,
               5 => 1082,
               6 => 1073,
               7 => 1099,
               8 => 1129,
               9 => 1129,
               10 => 928,
               11 => 995,
               12 => 1177
             },
             "Giuliano" => %{
               1 => 1107,
               2 => 1173,
               3 => 1097,
               4 => 1152,
               5 => 1182,
               6 => 1197,
               7 => 1169,
               8 => 1126,
               9 => 1140,
               10 => 1123,
               11 => 1105,
               12 => 1100
             },
             "Jakeliny" => %{
               1 => 1118,
               2 => 1119,
               3 => 1178,
               4 => 1172,
               5 => 1129,
               6 => 1182,
               7 => 1245,
               8 => 1098,
               9 => 1264,
               10 => 1197,
               11 => 1085,
               12 => 1122
             },
             "Joseph" => %{
               1 => 1084,
               2 => 1202,
               3 => 1038,
               4 => 1047,
               5 => 1082,
               6 => 1105,
               7 => 1153,
               8 => 1167,
               9 => 1111,
               10 => 1058,
               11 => 1005,
               12 => 1122
             },
             "Mayk" => %{
               1 => 1100,
               2 => 1085,
               3 => 1166,
               4 => 1016,
               5 => 1173,
               6 => 1190,
               7 => 1093,
               8 => 1079,
               9 => 1114,
               10 => 1094,
               11 => 1257,
               12 => 1159
             },
             "Rafael" => %{
               1 => 1125,
               2 => 1042,
               3 => 1220,
               4 => 1171,
               5 => 1141,
               6 => 1218,
               7 => 1097,
               8 => 1199,
               9 => 1095,
               10 => 1161,
               11 => 1163,
               12 => 965
             },
             "Vinicius" => %{
               1 => 1036,
               2 => 1102,
               3 => 1191,
               4 => 1149,
               5 => 1109,
               6 => 1213,
               7 => 979,
               8 => 1055,
               9 => 1110,
               10 => 1113,
               11 => 1169,
               12 => 1186
             }
           },
           "hours_per_year" => %{
             "Cleiton" => %{2016 => 2699, 2017 => 2684, 2018 => 2805, 2019 => 2714, 2020 => 2895},
             "Daniele" => %{2016 => 2573, 2017 => 2862, 2018 => 2633, 2019 => 2562, 2020 => 2634},
             "Danilo" => %{2016 => 2746, 2017 => 2534, 2018 => 2972, 2019 => 2666, 2020 => 2665},
             "Diego" => %{2016 => 2577, 2017 => 2647, 2018 => 2792, 2019 => 2486, 2020 => 2513},
             "Giuliano" => %{2016 => 2784, 2017 => 2696, 2018 => 2693, 2019 => 2850, 2020 => 2648},
             "Jakeliny" => %{2016 => 2869, 2017 => 2625, 2018 => 2765, 2019 => 2709, 2020 => 2941},
             "Joseph" => %{2016 => 2603, 2017 => 2617, 2018 => 2587, 2019 => 2672, 2020 => 2695},
             "Mayk" => %{2016 => 2644, 2017 => 2735, 2018 => 2770, 2019 => 2778, 2020 => 2599},
             "Rafael" => %{2016 => 2684, 2017 => 2570, 2018 => 2628, 2019 => 2786, 2020 => 2929},
             "Vinicius" => %{2016 => 2530, 2017 => 2720, 2018 => 2654, 2019 => 2640, 2020 => 2868}
           }
         }}

      assert response == expected_response
    end

    test "when a file list is not provided, returns an error" do
      response = ReportsGeneratorChallenge2.build_from_many("banana")

      expected_response = {:error, "Please provide a list of strings"}

      assert response == expected_response
    end
  end
end
